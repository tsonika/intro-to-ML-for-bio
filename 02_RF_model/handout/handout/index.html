


<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="This contains all material for the Introduction to NGS workshop.">
      
      
      
        <meta name="author" content="Sonika Tyagi">
      
      <link rel="shortcut icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-5.2.3">
    
    
      
        <title>ML model - Introduction to ML for Bioinformaticians Using Google Colaboratory</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.6e35a1a6.min.css">
      
      
    
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
      <link rel="stylesheet" href="../../../css/details.css">
    
    
      
    
    
  </head>
  
  
    <body dir="ltr">
  
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#building-a-random-forest-model-rf-to-classify-a-set-of-sequences" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="../../.." title="Introduction to ML for Bioinformaticians Using Google Colaboratory" class="md-header-nav__button md-logo" aria-label="Introduction to ML for Bioinformaticians Using Google Colaboratory">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            Introduction to ML for Bioinformaticians Using Google Colaboratory
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              ML model
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
        
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Introduction to ML for Bioinformaticians Using Google Colaboratory" class="md-nav__button md-logo" aria-label="Introduction to ML for Bioinformaticians Using Google Colaboratory">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Introduction to ML for Bioinformaticians Using Google Colaboratory
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../trainers/trainers.md" title="The Trainers" class="md-nav__link">
      The Trainers
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3" checked>
    
    <label class="md-nav__link" for="nav-3">
      Hands-on Modules
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Hands-on Modules" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Hands-on Modules
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../00_data_intro/handout/handout/" title="Data Introduction" class="md-nav__link">
      Data Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../01_tokenization/handout/handout/" title="Tokenization" class="md-nav__link">
      Tokenization
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        ML model
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 9h14V7H3v2m0 4h14v-2H3v2m0 4h14v-2H3v2m16 0h2v-2h-2v2m0-10v2h2V7h-2m0 6h2v-2h-2v2z"/></svg>
        </span>
      </label>
    
    <a href="./" title="ML model" class="md-nav__link md-nav__link--active">
      ML model
    </a>
    
      
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#learning-objectives" class="md-nav__link">
    Learning objectives:
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#resources-youll-be-using" class="md-nav__link">
    Resources You’ll be Using
  </a>
  
    <nav class="md-nav" aria-label="Resources You’ll be Using">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#data" class="md-nav__link">
    Data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tools-used" class="md-nav__link">
    Tools Used
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#useful-links" class="md-nav__link">
    Useful Links
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#author-information" class="md-nav__link">
    Author Information
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#workflow" class="md-nav__link">
    Workflow
  </a>
  
    <nav class="md-nav" aria-label="Workflow">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-read-in-the-data-and-split-each-input-sequence-into-tokens" class="md-nav__link">
    1) Read in the data and split each input sequence into "tokens".
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-denoise-the-data-if-needed" class="md-nav__link">
    2) Denoise the data if needed
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-convert-data-into-numeric-presentation" class="md-nav__link">
    3) Convert data into numeric presentation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-split-the-data-into-train-test-and-validation-sets" class="md-nav__link">
    4) Split the data into train, test, and validation sets
  </a>
  
    <nav class="md-nav" aria-label="4) Split the data into train, test, and validation sets">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#random-forest-classication" class="md-nav__link">
    Random Forest classication
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../license/" title="License" class="md-nav__link">
      License
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#learning-objectives" class="md-nav__link">
    Learning objectives:
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#resources-youll-be-using" class="md-nav__link">
    Resources You’ll be Using
  </a>
  
    <nav class="md-nav" aria-label="Resources You’ll be Using">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#data" class="md-nav__link">
    Data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tools-used" class="md-nav__link">
    Tools Used
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#useful-links" class="md-nav__link">
    Useful Links
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#author-information" class="md-nav__link">
    Author Information
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#workflow" class="md-nav__link">
    Workflow
  </a>
  
    <nav class="md-nav" aria-label="Workflow">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-read-in-the-data-and-split-each-input-sequence-into-tokens" class="md-nav__link">
    1) Read in the data and split each input sequence into "tokens".
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-denoise-the-data-if-needed" class="md-nav__link">
    2) Denoise the data if needed
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-convert-data-into-numeric-presentation" class="md-nav__link">
    3) Convert data into numeric presentation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-split-the-data-into-train-test-and-validation-sets" class="md-nav__link">
    4) Split the data into train, test, and validation sets
  </a>
  
    <nav class="md-nav" aria-label="4) Split the data into train, test, and validation sets">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#random-forest-classication" class="md-nav__link">
    Random Forest classication
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  
                
                
                <h1 id="building-a-random-forest-model-rf-to-classify-a-set-of-sequences">Building a Random Forest model (RF) to classify a set of sequences</h1>
<p>The objective of this exercise is to build a classiciation model that is training on two groups of sequences with known labels i.e. &ldquo;promoter&rdquo; and &ldquo;non-promoter&rdquo;. The model is then trained on a held out model to make prediction - whether the given sequence is a promoter or not.</p>
<h2 id="learning-objectives">Learning objectives:</h2>
<p>At the end of this practical you should be able to:</p>
<ul>
<li>Prepare input data forms for a ML model (RF)</li>
<li>Investigate parameters used in the model</li>
<li>Prepare training and test performance metrices and visualization</li>
</ul>
<hr />
<h2 id="resources-youll-be-using">Resources You’ll be Using</h2>
<h3 id="data">Data</h3>
<p>We have promoter seuqneces of Yeast as one group of data labeled as <code>1</code>, and a similar synthetic negative data was generated and labelled as <code>0</code>.
The data is provided in a file called <a href="../../data/promoter.csv"><code>promoter.csv</code></a> </p>
<h3 id="tools-used">Tools Used</h3>
<p>Python Package:<br />
pandas, numpym sklearn, matplotlib, seaborn</p>
<p>Google Colaboratory:<br />
<a href="https://colab.research.google.com/">https://colab.research.google.com/</a></p>
<hr />
<h2 id="useful-links">Useful Links</h2>
<p>Random Classifier
<a href="https://scikit-learn.org/stable/modules/generated/sklearn.ensemble.RandomForestClassifier.html">https://scikit-learn.org/stable/modules/generated/sklearn.ensemble.RandomForestClassifier.html</a></p>
<p>Confusion matrix:
<a href="https://scikit-learn.org/stable/modules/generated/sklearn.metrics.confusion_matrix.html">https://scikit-learn.org/stable/modules/generated/sklearn.metrics.confusion_matrix.html</a></p>
<p>A read on ROC curves
<a href="https://aiineverything.blogspot.com/2021/08/misconception--around-roc-auc.html">https://aiineverything.blogspot.com/2021/08/misconception--around-roc-auc.html</a></p>
<hr />
<h2 id="author-information">Author Information</h2>
<p><em>Primary Author(s):</em>  <br />
Sonika Tyagi, Navya Tyagi</p>
<p><em>Contributor(s):</em>  <br />
Tyrone Chen, Sarthak Chauhan </p>
<hr />
<h2 id="workflow">Workflow</h2>
<p>Assuming you have obtained well-defined sequence data and their corresponding metadata:</p>
<ol>
<li>Read in the data and split each input sequence into &ldquo;k-mers&rdquo; or &ldquo;tokens&rdquo;.</li>
<li>Denoise the data if needed.[optional]</li>
<li>Convert these tokens into a numeric representation.</li>
<li>Split the data into <code>train</code>, <code>test</code>, and <code>validation</code> sets.</li>
<li>Train, optimize, and validate the model.</li>
</ol>
<p><em>NOTE</em>: in the context of this tutorial, we will be using the term <code>token</code> and <code>k-mer</code> interchangeably.</p>
<p>First lets load the required python packages:</p>
<div class="highlight"><pre><span></span><code>import pandas as pd
import numpy as np
from sklearn.model_selection import train_test_split, GridSearchCV, cross_val_score, cross_validate
from sklearn.ensemble import RandomForestClassifier
from sklearn.metrics import accuracy_score, confusion_matrix, classification_report, plot_confusion_matrix
from pprint import pprint
import matplotlib.pyplot as plt
import seaborn as sns
from sklearn.feature_extraction.text import CountVectorizer
</code></pre></div>

<h3 id="1-read-in-the-data-and-split-each-input-sequence-into-tokens">1) Read in the data and split each input sequence into &ldquo;tokens&rdquo;.</h3>
<p>We have prepared a data file (<code>.csv</code> format) contain sequences from <code>promoter</code> (label <code>1</code>) and <code>non-promoter</code> (label <code>0</code>) groups.</p>
<div class="highlight"><pre><span></span><code>dna = pd.read_csv(&#39;/content/promoter.csv&#39;)
dna.head()
</code></pre></div>

<p>Lets check the size of the data:</p>
<div class="highlight"><pre><span></span><code>color = [sns.xkcd_rgb[&#39;medium blue&#39;], sns.xkcd_rgb[&#39;pale red&#39;]]
sns.countplot(&#39;labels&#39;,data = dna, palette = color)
plt.gca().set_ylabel(&#39;Samples (number of sequences)&#39;)
</code></pre></div>

<p>Here, is a resuable function to split sequences into k-mers:
<div class="highlight"><pre><span></span><code>def get_kmers(sequence: str, length: int):
  &quot;&quot;&quot;
  Take a dna sequence as input and split the sequence into k-mers / tokens
  &quot;&quot;&quot;
  return [sequence[x:x+length].upper() for x in range(len(sequence) - length + 1)]
</code></pre></div></p>
<p>Use the above function with the sequence data now stored in a dataframe named <code>dna</code>:
<div class="highlight"><pre><span></span><code># in this example, we will split on length 5 k-mers
kmer_length = 
seq=dna.sequence[0]
dna[&#39;kmers&#39;] = dna.apply(lambda x: get_kmers(x[&#39;sequence&#39;], kmer_length), axis=1)
print(dna.head())
</code></pre></div>
We have previously determined the length of <code>kmer=5</code> to be used here.</p>
<p>We will next join the individual <code>kmers</code> to long string of sentence equivalent. Use the following function:</p>
<p><div class="highlight"><pre><span></span><code>def to_sentence(words):
  r&quot;&quot;&quot;This function formats the k-mers such that it is useful for language models where algorithm expects sequences of words&quot;&quot;&quot;
  initial=&#39;&#39;
  for element in range(len(words)):
    words[element]=&#39; &#39;.join(words[element])
  return words
</code></pre></div>
First, extract the <code>kmers</code> column as a list and then perform the joining opration.</p>
<div class="highlight"><pre><span></span><code>dna_text = list(dna[&#39;kmers&#39;])
#get kmers/words joined together with space between them
joined_kmers=to_sentence(dna_text)
print(len(joined_kmers))
</code></pre></div>

<h3 id="2-denoise-the-data-if-needed">2) Denoise the data if needed</h3>
<p>In some cases, we want to remove certain tokens, commonly tokens with low information content. In English, this is straightforward and involves filtering out &ldquo;stopwords&rdquo;, for example <code>the</code>, <code>and</code> or <code>is</code>. In Biology, this is not always done, and will require review on a case-by-case basis.</p>
<div class="highlight"><pre><span></span><code>def filter_kmers(tokens: str, stopwords: list):
  &quot;&quot;&quot;
  Take an input dna sequence and list of stopwords to remove from the data.
  &quot;&quot;&quot;
  return [x for x in tokens if x not in stopwords]

# in this example, let us pretend this list of k-mers have low information content
stopwords = [AAAAA&quot;, &quot;TTTTT&quot;]
filtered_kmers = filter_kmers(kmers, stopwords)
print(filtered_kmers)
</code></pre></div>

<h3 id="3-convert-data-into-numeric-presentation">3) Convert data into numeric presentation</h3>
<p>Here, we are using a frequuency transformation based approach.</p>
<p>The n-gram size of 4 is previously determined by testing
<div class="highlight"><pre><span></span><code>cv = CountVectorizer(ngram_range=(,), max_features=500) 
X = cv.fit_transform(joined_kmers)

#get feature names
# X and Y should have same length 

#separate labels
Y=np.array(dna[&#39;labels&#39;])
print(&quot;Total data iterms:&quot;,X.shape)
print(&quot;Total data labels&quot;, Y.shape)
</code></pre></div></p>
<p>Take a peek into the count vector we just created:</p>
<div class="highlight"><pre><span></span><code>cv.get_feature_names_out()[10:50]
</code></pre></div>

<h3 id="4-split-the-data-into-train-test-and-validation-sets">4) Split the data into train, test, and validation sets</h3>
<div class="highlight"><pre><span></span><code>def split_dataset(X, Y, train_ratio, test_ratio, validation_ratio):
    x_train, x_test, y_train, y_test = train_test_split(X, Y, test_size=1 - train_ratio)
    x_val, x_test, y_val, y_test = train_test_split(x_test, y_test, test_size=test_ratio/(test_ratio + validation_ratio))
    return x_train, y_train, x_test, y_test, x_val, y_val
</code></pre></div>

<div class="highlight"><pre><span></span><code># split the dataset into train, test and validation set using sklearn
train_ratio = 0.70
validation_ratio = 0.15
test_ratio = 0.15
# train is now 70% of the entire data set
# test is now 15% of the initial data set
# validation is now 15% of the initial data set
x_train, y_train, x_test, y_test, x_val, y_val=split_dataset(X, Y, train_ratio, test_ratio, validation_ratio) 
print(&quot;Training data:&quot;,x_train.shape)
print(&quot;Training data labels:&quot;,y_train.shape)
print(&quot;Test data:&quot;,x_test.shape)
print(&quot;Test data labels:&quot;,y_test.shape)
print(&quot;Validation data:&quot;,x_val.shape)
print(&quot;Validation data labels:&quot;,y_val.shape)
</code></pre></div>

<p>Functions to run training and perform assessment</p>
<div class="highlight"><pre><span></span><code>def train_model(model, param, x_train, y_train, x_test):
     clf=model(n_estimators=param)
     # fit the training data into the model
     clf.fit(x_train, y_train)
     y_pred=clf.predict(x_test)
     y_probas=clf.predict_proba(x_test)
     return clf, y_pred, y_probas

def model_metrics(model, x_test, y_test, y_pred):
  # accuracy prediction
  accuracy = accuracy_score(y_test, y_pred)
  print(&quot;Accuracy: %.2f%%&quot; % (accuracy * 100.0))
  # classification report
  print(&quot;Classification report:\n&quot;)
  print(classification_report(y_test, y_pred))
  # confusion matrix
  conf=confusion_matrix(y_test, y_pred)
  print(&quot;Confusion matrix:\n&quot;, conf)
</code></pre></div>

<h4 id="random-forest-classication">Random Forest classication</h4>
<p>We have two steps here: 1) we train the model 2) we test it on unseen data
<div class="highlight"><pre><span></span><code>print(&#39;RF BASE MODEL&#39;)
## training the model
model=RandomForestClassifier
param=100
rf_base, y_pred, y_probas=train_model(model, param, x_train, y_train, x_test)
# model metrics
model_metrics(rf_base, x_test, y_test, y_pred)
</code></pre></div></p>
<p>Lets plot a ROC-AUC curve:</p>
<p><div class="highlight"><pre><span></span><code>from sklearn.metrics import RocCurveDisplay
ax = plt.gca()
rfc_disp = RocCurveDisplay.from_estimator(rf_base, x_test, y_test, ax=ax, alpha=0.8)
#rfc_disp.plot(ax=ax, alpha=0.8)
plt.show()
</code></pre></div>
For this exercise we have run the model with default paramters but in real practice we will running and optimisation step where we will find the best paramter settings for pur case study.</p>
<p>We will discuss that topic on another day!</p>
<p>The learning plots can give an idea whether the model is over or underfitting:</p>
<div class="highlight"><pre><span></span><code>from sklearn.ensemble import RandomForestRegressor
from sklearn.metrics import mean_squared_error
import matplotlib.pyplot as plt
from matplotlib.legend_handler import HandlerLine2D

train_results = []
test_results = []
list_nb_trees = [5, 10, 15, 30, 45, 60, 80, 100]

for nb_trees in list_nb_trees:
    rf = RandomForestRegressor(n_estimators=nb_trees)
    rf.fit(x_train, y_train)

    train_results.append(mean_squared_error(y_train, rf.predict(x_train)))
    test_results.append(mean_squared_error(y_test, rf.predict(x_test)))

line1, = plt.plot(list_nb_trees, train_results, color=&quot;r&quot;, label=&quot;Training Score&quot;)
line2, = plt.plot(list_nb_trees, test_results, color=&quot;g&quot;, label=&quot;Testing Score&quot;)

plt.legend(handler_map={line1: HandlerLine2D(numpoints=2)})
plt.ylabel(&#39;MSE&#39;)
plt.xlabel(&#39;n_estimators&#39;)
plt.show()
</code></pre></div>

<h1 id="end">END</h1>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="../../../01_tokenization/handout/handout/" title="Tokenization" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Tokenization
              </div>
            </div>
          </a>
        
        
          <a href="../../../license/" title="License" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                License
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            &copy; The authors; 2022-
          </div>
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../../assets/javascripts/vendor.d710d30a.min.js"></script>
      <script src="../../../assets/javascripts/bundle.a45f732b.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents"}</script>
      
      <script>
        app = initialize({
          base: "../../..",
          features: [],
          search: Object.assign({
            worker: "../../../assets/javascripts/worker/search.c03f0417.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
      
        <script src="../../../js/details.js"></script>
      
    
  </body>
</html>