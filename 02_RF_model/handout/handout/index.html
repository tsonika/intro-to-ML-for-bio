
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="This contains all material for the Introduction to NGS workshop.">
      
      
        <meta name="author" content="Sonika Tyagi">
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.0, mkdocs-material-8.5.6">
    
    
      
        <title>ML model - Introduction to ML for Biologists</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.20d9efc8.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.cbb835fc.min.css">
        
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../css/details.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#building-a-random-forest-model-rf-to-classify-a-set-of-sequences" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="Introduction to ML for Biologists" class="md-header__button md-logo" aria-label="Introduction to ML for Biologists" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Introduction to ML for Biologists
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              ML model
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Introduction to ML for Biologists" class="md-nav__button md-logo" aria-label="Introduction to ML for Biologists" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Introduction to ML for Biologists
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../trainers/trainers/" class="md-nav__link">
        The Trainers
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          Hands-on Modules
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Hands-on Modules" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Hands-on Modules
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../00_data_intro/handout/handout/" class="md-nav__link">
        Data Introduction
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../01_tokenization/handout/handout/" class="md-nav__link">
        Tokenization
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          ML model
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        ML model
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#learning-objectives" class="md-nav__link">
    Learning objectives:
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#resources-youll-be-using" class="md-nav__link">
    Resources You’ll be Using
  </a>
  
    <nav class="md-nav" aria-label="Resources You’ll be Using">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#data" class="md-nav__link">
    Data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tools-used" class="md-nav__link">
    Tools Used
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#useful-links" class="md-nav__link">
    Useful Links
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#author-information" class="md-nav__link">
    Author Information
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#workflow" class="md-nav__link">
    Workflow
  </a>
  
    <nav class="md-nav" aria-label="Workflow">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-read-in-the-data-and-split-each-input-sequence-into-tokens" class="md-nav__link">
    1) Read in the data and split each input sequence into "tokens".
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-denoise-the-data-if-needed" class="md-nav__link">
    2) Denoise the data if needed
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-convert-data-into-numeric-presentation" class="md-nav__link">
    3) Convert data into numeric presentation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-split-the-data-into-train-test-and-validation-sets" class="md-nav__link">
    4) Split the data into train, test, and validation sets
  </a>
  
    <nav class="md-nav" aria-label="4) Split the data into train, test, and validation sets">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#random-forest-classication" class="md-nav__link">
    Random Forest classication
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../license/" class="md-nav__link">
        License
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#learning-objectives" class="md-nav__link">
    Learning objectives:
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#resources-youll-be-using" class="md-nav__link">
    Resources You’ll be Using
  </a>
  
    <nav class="md-nav" aria-label="Resources You’ll be Using">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#data" class="md-nav__link">
    Data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tools-used" class="md-nav__link">
    Tools Used
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#useful-links" class="md-nav__link">
    Useful Links
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#author-information" class="md-nav__link">
    Author Information
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#workflow" class="md-nav__link">
    Workflow
  </a>
  
    <nav class="md-nav" aria-label="Workflow">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-read-in-the-data-and-split-each-input-sequence-into-tokens" class="md-nav__link">
    1) Read in the data and split each input sequence into "tokens".
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-denoise-the-data-if-needed" class="md-nav__link">
    2) Denoise the data if needed
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-convert-data-into-numeric-presentation" class="md-nav__link">
    3) Convert data into numeric presentation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-split-the-data-into-train-test-and-validation-sets" class="md-nav__link">
    4) Split the data into train, test, and validation sets
  </a>
  
    <nav class="md-nav" aria-label="4) Split the data into train, test, and validation sets">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#random-forest-classication" class="md-nav__link">
    Random Forest classication
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="building-a-random-forest-model-rf-to-classify-a-set-of-sequences">Building a Random Forest model (RF) to classify a set of sequences</h1>
<p>The objective of this exercise is to build a classiciation model that is training on two groups of sequences with known labels i.e. &ldquo;promoter&rdquo; and &ldquo;non-promoter&rdquo;. The model is then trained on a held out model to make prediction - whether the given sequence is a promoter or not.</p>
<h2 id="learning-objectives">Learning objectives:</h2>
<p>At the end of this practical you should be able to:</p>
<ul>
<li>Prepare input data forms for a ML model (RF)</li>
<li>Investigate parameters used in the model</li>
<li>Prepare training and test performance metrices and visualization</li>
</ul>
<hr />
<h2 id="resources-youll-be-using">Resources You’ll be Using</h2>
<h3 id="data">Data</h3>
<p>We have promoter seuqneces of Yeast as one group of data labeled as <code>1</code> and a similar synthetic negative data was generated and labelled as <code>0</code>.
The data is provided as a file called <a href="../../data/promoter.csv"><code>promoter.csv</code></a> </p>
<h3 id="tools-used">Tools Used</h3>
<p>Python Package:<br />
pandas, numpym sklearn, matplotlib, seaborn</p>
<p>Google Colaboratory:<br />
<a href="https://colab.research.google.com/">https://colab.research.google.com/</a></p>
<hr />
<h2 id="useful-links">Useful Links</h2>
<p>Random Classifier
<a href="https://scikit-learn.org/stable/modules/generated/sklearn.ensemble.RandomForestClassifier.html">https://scikit-learn.org/stable/modules/generated/sklearn.ensemble.RandomForestClassifier.html</a></p>
<p>Confusion matrix:
<a href="https://scikit-learn.org/stable/modules/generated/sklearn.metrics.confusion_matrix.html">https://scikit-learn.org/stable/modules/generated/sklearn.metrics.confusion_matrix.html</a></p>
<p>A read on ROC curves
<a href="https://aiineverything.blogspot.com/2021/08/misconception--around-roc-auc.html">https://aiineverything.blogspot.com/2021/08/misconception--around-roc-auc.html</a></p>
<hr />
<h2 id="author-information">Author Information</h2>
<p><em>Primary Author(s):</em>  <br />
Sonika Tyagi, Navya Tyagi</p>
<p><em>Contributor(s):</em>  <br />
Tyrone Chen, Sarthak Chauhan </p>
<hr />
<h2 id="workflow">Workflow</h2>
<p>Assuming you have obtained well-defined sequence data and their corresponding metadata:</p>
<ol>
<li>Read in the data and split each input sequence into &ldquo;k-mers&rdquo; or &ldquo;tokens&rdquo;.</li>
<li>Denoise the data if needed.[optional]</li>
<li>Convert these tokens into a numeric representation.</li>
<li>Split the data into <code>train</code>, <code>test</code>, and <code>validation</code> sets.</li>
<li>Train, optimize, and validate the model.</li>
</ol>
<p><em>NOTE</em>: in the context of this tutorial, we will be using the term <code>token</code> and <code>k-mer</code> interchangeably.</p>
<p>First lets load the required python packages:</p>
<div class="highlight"><pre><span></span><code>import pandas as pd
import numpy as np
from sklearn.model_selection import train_test_split, GridSearchCV, cross_val_score, cross_validate
from sklearn.ensemble import RandomForestClassifier
from sklearn.metrics import accuracy_score, confusion_matrix, classification_report, plot_confusion_matrix
from pprint import pprint
import matplotlib.pyplot as plt
import seaborn as sns
from sklearn.feature_extraction.text import CountVectorizer
</code></pre></div>
<h3 id="1-read-in-the-data-and-split-each-input-sequence-into-tokens">1) Read in the data and split each input sequence into &ldquo;tokens&rdquo;.</h3>
<p>We have prepared a data file (<code>.csv</code> format) contain sequences from <code>promoter</code> (label <code>1</code>) and <code>non-promoter</code> (label <code>0</code>) groups.</p>
<div class="highlight"><pre><span></span><code>dna = pd.read_csv(&#39;/content/promoter.csv&#39;)
dna.head()
</code></pre></div>
<p>Lets check the size of the data:</p>
<div class="highlight"><pre><span></span><code>color = [sns.xkcd_rgb[&#39;medium blue&#39;], sns.xkcd_rgb[&#39;pale red&#39;]]
sns.countplot(&#39;labels&#39;,data = dna, palette = color)
plt.gca().set_ylabel(&#39;Samples (number of sequences)&#39;)
</code></pre></div>
<p>Here, is a resuable function to split sequences into k-mers:
<div class="highlight"><pre><span></span><code>def get_kmers(sequence: str, length: int):
  &quot;&quot;&quot;
  Take a dna sequence as input and split the sequence into k-mers / tokens
  &quot;&quot;&quot;
  return [sequence[x:x+length].upper() for x in range(len(sequence) - length + 1)]
</code></pre></div></p>
<p>Use the above function with the sequence data now stored in a dataframe named <code>dna</code>:
<div class="highlight"><pre><span></span><code># in this example, we will split on length 5 k-mers
kmer_length = 
seq=dna.sequence[0]
dna[&#39;kmers&#39;] = dna.apply(lambda x: get_kmers(x[&#39;sequence&#39;], kmer_length), axis=1)
print(dna.head())
</code></pre></div>
We have previously determined the length of <code>kmer=5</code> to be used here.</p>
<p>We will next join the individual <code>kmers</code> to long string of sentence equivalent. Use the following function:</p>
<p><div class="highlight"><pre><span></span><code>def to_sentence(words):
  r&quot;&quot;&quot;This function formats the k-mers such that it is useful for language models where algorithm expects sequences of words&quot;&quot;&quot;
  initial=&#39;&#39;
  for element in range(len(words)):
    words[element]=&#39; &#39;.join(words[element])
  return words
</code></pre></div>
First, extract the <code>kmers</code> column as a list and then perform the joining opration.</p>
<div class="highlight"><pre><span></span><code>dna_text = list(dna[&#39;kmers&#39;])
#get kmers/words joined together with space between them
joined_kmers=to_sentence(dna_text)
print(len(joined_kmers))
</code></pre></div>
<h3 id="2-denoise-the-data-if-needed">2) Denoise the data if needed</h3>
<p>In some cases, we want to remove certain tokens, commonly tokens with low information content. In English, this is straightforward and involves filtering out &ldquo;stopwords&rdquo;, for example <code>the</code>, <code>and</code> or <code>is</code>. In Biology, this is not always done, and will require review on a case-by-case basis.</p>
<div class="highlight"><pre><span></span><code>def filter_kmers(tokens: str, stopwords: list):
  &quot;&quot;&quot;
  Take an input dna sequence and list of stopwords to remove from the data.
  &quot;&quot;&quot;
  return [x for x in tokens if x not in stopwords]

# in this example, let us pretend this list of k-mers have low information content
stopwords = [AAAAA&quot;, &quot;TTTTT&quot;]
filtered_kmers = filter_kmers(kmers, stopwords)
print(filtered_kmers)
</code></pre></div>
<h3 id="3-convert-data-into-numeric-presentation">3) Convert data into numeric presentation</h3>
<p>Here, we are using a frequuency transformation based approach.</p>
<p>The n-gram size of 4 is previously determined by testing
<div class="highlight"><pre><span></span><code>cv = CountVectorizer(ngram_range=(,), max_features=500) 
X = cv.fit_transform(joined_kmers)

#get feature names
feature=cv.get_feature_names_out()
# X and Y should have same length 

#separate labels
Y=np.array(dna[&#39;labels&#39;])
print(&quot;Total data iterms:&quot;,X.shape)
print(&quot;Total data labels&quot;, Y.shape)
</code></pre></div></p>
<p>Take a peek into the count vector we just created:</p>
<div class="highlight"><pre><span></span><code>cv.get_feature_names_out()[10:50]
</code></pre></div>
<p>You can visualise the token frequencies:</p>
<p>Funtion to visualize frequencies:</p>
<p><div class="highlight"><pre><span></span><code>from yellowbrick.text import FreqDistVisualizer
def token_freq_plot(feature):
  visualizer = FreqDistVisualizer(features=feature, orient=&#39;v&#39;)
  visualizer.fit(X)
  visualizer.show()
</code></pre></div>
<div class="highlight"><pre><span></span><code>token_freq_plot(feature)
</code></pre></div></p>
<h3 id="4-split-the-data-into-train-test-and-validation-sets">4) Split the data into train, test, and validation sets</h3>
<div class="highlight"><pre><span></span><code>def split_dataset(X, Y, train_ratio, test_ratio, validation_ratio):
    x_train, x_test, y_train, y_test = train_test_split(X, Y, test_size=1 - train_ratio)
    x_val, x_test, y_val, y_test = train_test_split(x_test, y_test, test_size=test_ratio/(test_ratio + validation_ratio))
    return x_train, y_train, x_test, y_test, x_val, y_val
</code></pre></div>
<div class="highlight"><pre><span></span><code># split the dataset into train, test and validation set using sklearn
train_ratio = 0.70
validation_ratio = 0.15
test_ratio = 0.15
# train is now 70% of the entire data set
# test is now 15% of the initial data set
# validation is now 15% of the initial data set
x_train, y_train, x_test, y_test, x_val, y_val=split_dataset(X, Y, train_ratio, test_ratio, validation_ratio) 
print(&quot;Training data:&quot;,x_train.shape)
print(&quot;Training data labels:&quot;,y_train.shape)
print(&quot;Test data:&quot;,x_test.shape)
print(&quot;Test data labels:&quot;,y_test.shape)
print(&quot;Validation data:&quot;,x_val.shape)
print(&quot;Validation data labels:&quot;,y_val.shape)
</code></pre></div>
<p>Functions to run training and perform assessment</p>
<div class="highlight"><pre><span></span><code>def train_model(model, param, x_train, y_train, x_test):
     clf=model(n_estimators=param)
     # fit the training data into the model
     clf.fit(x_train, y_train)
     y_pred=clf.predict(x_test)
     y_probas=clf.predict_proba(x_test)
     return clf, y_pred, y_probas

def model_metrics(model, x_test, y_test, y_pred):
  # accuracy prediction
  accuracy = accuracy_score(y_test, y_pred)
  print(&quot;Accuracy: %.2f%%&quot; % (accuracy * 100.0))
  # classification report
  print(&quot;Classification report:\n&quot;)
  print(classification_report(y_test, y_pred))
  # confusion matrix
  conf=confusion_matrix(y_test, y_pred)
  print(&quot;Confusion matrix:\n&quot;, conf)


def feature_imp(model,feature_names, n_top_features):
  feats=np.array(feature_names)
  importances = model.feature_importances_
  indices = np.argsort(importances)[::-1]
  plt.figure(figsize=(8,10))
  plt.barh(feats[indices][:n_top_features ], importances[indices][:n_top_features ])
  plt.xlabel(&quot;RF feature Importance &quot;)
</code></pre></div>
<h4 id="random-forest-classication">Random Forest classication</h4>
<p>We have two steps here: 1) we train the model 2) we test it on unseen data
<div class="highlight"><pre><span></span><code>print(&#39;RF BASE MODEL&#39;)
## training the model
model=RandomForestClassifier
param=100
rf_base, y_pred, y_probas=train_model(model, param, x_train, y_train, x_test)
# model metrics
model_metrics(rf_base, x_test, y_test, y_pred)


##Feature imp plot
print(&quot;Feature Importance Plot:\n&quot;)
feature_imp(rf_base, feature, 10)
</code></pre></div></p>
<p>Lets plot a ROC-AUC plot:</p>
<p><div class="highlight"><pre><span></span><code>from sklearn.metrics import RocCurveDisplay
ax = plt.gca()
rfc_disp = RocCurveDisplay.from_estimator(rf_base, x_test, y_test, ax=ax, alpha=0.8)
#rfc_disp.plot(ax=ax, alpha=0.8)
plt.show()
</code></pre></div>
For this exercise we have run the model with default paramters but in real practice we will running and optimisation step where we will find the best paramter settings for pur case study.</p>
<p>We will discuss that topic on another day!</p>
<h1 id="end">END</h1>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href="../../../01_tokenization/handout/handout/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Tokenization" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Tokenization
            </div>
          </div>
        </a>
      
      
        
        <a href="../../../license/" class="md-footer__link md-footer__link--next" aria-label="Next: License" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              License
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      &copy; The authors; 2022-
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../../..", "features": [], "search": "../../../assets/javascripts/workers/search.5bf1dace.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.078830c0.min.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
      
        <script src="../../../js/details.js"></script>
      
    
  </body>
</html>